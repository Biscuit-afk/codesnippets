// BOM Explosion on materials ( CK13N for list of material ).

TABLES: BAPICSTGVA,
        BAPIMATERI,
        BAPIPLANT,
        BAPIVALIDI,
        BAPICSTGST,
        BAPICOLIST,
        BAPIHEADER,
        BAPICOSTINGVERSION.

DATA: RETURNDETAIL LIKE BAPIRETURN,
      RETURNLIST LIKE BAPIRETURN,
      RETURNEXPLOSION LIKE BAPIRETURN,
      COSTESTIMATE_LIST LIKE BAPICOLIST OCCURS 0 WITH HEADER LINE,
      COST_COMPONENTS LIKE BAPISPLITT OCCURS 0 WITH HEADER LINE,
      COST_ESTIMATE_HEADER LIKE BAPIHEADER,
      EXPLOSION_LIST LIKE BAPIEXPLOSIONLIST OCCURS 0 WITH HEADER LINE,
      EXPLOSION_INCOMPLETE TYPE C,
      RETURNITEMIZATION LIKE BAPIRETURN,
      ITEMIZATION_HEADER LIKE BAPIITEMIZATIONHEADER,
      ITEMIZATION_LIST LIKE BAPIITEMIZATIONLIST OCCURS 0 WITH HEADER LINE.

 CALL FUNCTION 'BAPI_COSTESTIMATE_GETLIST'
     EXPORTING
          COST_ESTIMATE      = CSTEST
     IMPORTING
          RETURN             = RETURNLIST
     TABLES
          COSTING_VARIANT    = CSTGVA
          MATERIAL           = T_MATNR //Material list
          PLANT              = PLANT
          VALIDITY_FROM      = IT_VALID
          COSTING_STATUS     = CSTGSTAT
          COSTING_VERSION    = CSTGVRSN
          COST_ESTIMATE_LIST = COSTESTIMATE_LIST
     EXCEPTIONS
          OTHERS             = 1.

/// Loop around COSTESTIMATE_LIST

    CALL FUNCTION 'BAPI_COSTESTIMATE_GETEXPLOSION'
       EXPORTING
            REFERENCEOBJECT      = WA_CLIST-REF_OBJECT
            COSTINGNUMBER        = WA_CLIST-CSTG_NUM
            COSTINGTYPE          = WA_CLIST-CSTG_TYPE
            COSTINGDATE          = WA_CLIST-CSTG_DATE
            COSTINGVERSION       = WA_CLIST-VERSION
            VALUATIONVARIANT     = WA_CLIST-VLTN_VRNT
            ENTEREDMANUALLY      = WA_CLIST-ENTER_MAN
            COST_COMPONENT_VIEW  = VIEW
            EXPLOSION_DEPTH      = DEPTH
            LOT_SIZE             = LOT_SIZE
       IMPORTING
            EXPLOSION_INCOMPLETE = EXPLOSION_INCOMPLETE
            RETURN               = RETURNEXPLOSION
       TABLES
            EXPLOSION_LIST       = EXPLOSION_LIST //CONTAINS ALL THE DATA OF MATERIAL EXPLOSION
       EXCEPTIONS
            OTHERS               = 0.

//EXPLODE MATERIAL USING LEVEL FIELD ACCORDING TO REQUIREMENTS


